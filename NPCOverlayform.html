<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <title>SDoehren's NPC Overlay</title>
    <link rel="icon" href="img/logo.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <style>
        h1 {text-align: center;}
        p {text-align: center;}
        div {text-align: center;}

        input[type="number"] {font-size:30px; font-weight: bold;}

        body {
    background-color: #454545;
    color: #E8E8E8;
    font-family: 'Lato';
}
        .container-fluid {padding: 5px 25px 25px 25px;}

        .row-bottom-margin { margin:0px; }

        .NPCOcharacterimg{position:fixed;
        bottom:0;
        left:25px;
        height: calc(75%);
        border: none;
    }

    .NPCOnamebox {

        background-color: #a06538;
        border-radius: 3px;
        color: #fff;
        display:flex;

        position: fixed;
        bottom: 300px;
        left: 425px;

        height: 100px;

        text-align: center;
        font-size: 45px;



        border: 10px solid #491b00;
        box-sizing: content-box;

        box-shadow: 10px 5px 5px rgba(0, 0, 0, 0.31);


    }


    .NPCOtextbox {

        background-color: #a06538;
        border-radius: 3px;
        color: #fff;
        position: fixed;
        bottom: 60px;
        left: 400px;
        width: calc(100% - 900px);
        height: 250px;

        margin-top:30px;

        text-align: center;
        font-size: 30px;


        border: 10px solid #491b00;
        box-sizing: content-box;

        box-shadow: 10px 5px 5px rgba(0, 0, 0, 0.31);
    }
    </style>
</head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M3RGJ7VH5D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M3RGJ7VH5D');
</script>

<body onload="generateOverlay()">
    <div class="navbar navbar-expand-lg navbar-dark bg-dark" href="/">
        <div class="d-flex flex-grow-1">
            <a class="navbar-brand mx-auto" href="https://ko-fi.com/sdoehren" target="_blank" rel="noopener noreferrer">
            <img src="https://img.shields.io/badge/ko--fi-Support%20Me-red?style=flat-square&amp;logo=ko-fi" alt="ko-fi"></a>
            <a class="navbar-brand mx-auto" href="/">SDoehren<img src="img/logo.webp" alt="Logo" height="30"></a>
            <a class="navbar-brand mx-auto" href="https://www.patreon.com/bePatron?u=49614365" target="_blank" rel="noopener noreferrer">
            <img src="https://img.shields.io/badge/Patreon-Support%20Me-red?style=flat-square&amp;logo=patreon" alt="Patreon"></a>
        </div>
    </div>

    <div class="container-fluid" style="z-index: 5;position:relative">
        <div class="row row-bottom-margin">
            <h1>NPC Overlay</h1>
        </div>
        <div class="row row-bottom-margin">
            <div class="col-4">
                <label id= 'ImageLoc-Label' for='ImageLoc'>Image Location</label><br>
                <input type='text' id='ImageLoc' name='ImageLoc' onchange='generateOverlay()' value='https://imgix.kotaku.com.au/content/uploads/sites/3/2020/10/23/wmoavl0pys5jce2dj94x.png' style = "width:90%;text-align: left;"><br>
            </div>
        <div class="col-4">
            <label id= 'Name-Label' for='NamePlate'>Name</label><br>
            <input type='text' id='NamePlate' name='NamePlate' onchange='generateOverlay()' value='Elfy McBbeg' style = "width:90%;text-align: left;"><br>
        </div>
            <div class="col-4">
                <label id= 'Message-Label' for='Message'>Message</label><br>
                <input type='text' id='Message' name='Message' onchange='generateOverlay()' value='This is a Test Message' style = "width:90%;text-align: left;"><br>
            </div>
        </div>
        <div class="row row-bottom-margin">
            <div class="col-4">
                <div class="row row-bottom-margin">
                    <h3>Name Plaque</h3>
                    <div class="col">
                        <label id= 'NameFont-Label' for='NameFont-Colour'>Font Colour</label><br>
                        <a style="text-decoration: none;" href="https://www.patreon.com/bePatron?u=49614365" target="_blank" rel="noopener noreferrer">
                            <p style="color: #FF424D;margin:0;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                        </a>
                        <input type='color' id='NameFont-Colour' name='NameFont-Colour' onchange='ColourChange(this)' value='#ffffff'><br>
                        <input type='text' id='NameFont-Text' name='NameFont-Text' onchange='TextChange(this)' value='#ffffff' style = "text-align: center;" size="8">
                    </div>
                    <div class="col">
                        <label id= 'NameBorder-Label' for='NameBorder-Colour'>Border Colour</label><br>
                        <a style="text-decoration: none;" href="https://www.patreon.com/bePatron?u=49614365" target="_blank" rel="noopener noreferrer">
                            <p style="color: #FF424D;margin:0;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                        </a>
                        <input type='color' id='NameBorder-Colour' name='NameBorder-Colour' onchange='ColourChange(this)' value='#491b00'><br>
                        <input type='text' id='NameBorder-Text' name='NameBorder-Text' onchange='TextChange(this)' value='#491b00' style = "text-align: center;" size="8">
                    </div>
                    <div class="col">
                        <label id= 'NameBackground1-Label' for='NameBackground1-Colour'>Background Colour 1</label><br>
                        <a style="text-decoration: none;" href="https://www.patreon.com/bePatron?u=49614365" target="_blank" rel="noopener noreferrer">
                            <p style="color: #FF424D;margin:0;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                        </a>
                        <input type='color' id='NameBackground1-Colour' name='NameBackground1-Colour' onchange='ColourChange(this)' value='#b57340'><br>
                        <input type='text' id='NameBackground1-Text' name='NameBackground1-Text' onchange='TextChange(this)' value='#b57340' style = "text-align: center;" size="8">
                    </div>
                    <div class="col">
                        <label id= 'NameBackground2-Label' for='NameBackground2-Colour'>Background Colour 2</label><br>
                        <a style="text-decoration: none;" href="https://www.patreon.com/bePatron?u=49614365" target="_blank" rel="noopener noreferrer">
                            <p style="color: #FF424D;margin:0;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                        </a>
                        <input type='color' id='NameBackground2-Colour' name='NameBackground-Colour' onchange='ColourChange(this)' value='#7b4319'><br>
                        <input type='text' id='NameBackground2-Text' name='NameBackground2-Text' onchange='TextChange(this)' value='#7b4319' style = "text-align: center;" size="8">
                    </div>
                </div>
            </div>
            <div class="col-4">
                <div class="row row-bottom-margin">
                    <h3>Output</h3>
                    <div class="col">
                        <br>
                        <input type='text' id='output' name='output' value='None' style = "width:90%;text-align: left;"><br>
                        <button class="btn btn-secondary" onclick="Copyoutput()">Copy Output</button>
                    </div>
                </div>
            </div>

            <div class="col-4">
                <div class="row row-bottom-margin">
                    <h3>Message Plaque</h3>
                    <div class="col">
                        <label id= 'MessageFont-Label' for='MessageFont-Colour'>Font Colour</label><br>
                        <a style="text-decoration: none;" href="https://www.patreon.com/bePatron?u=49614365" target="_blank" rel="noopener noreferrer">
                            <p style="color: #FF424D;margin:0;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                        </a>
                        <input type='color' id='MessageFont-Colour' name='MessageFont-Colour' onchange='ColourChange(this)' value='#ffffff'><br>
                        <input type='text' id='MessageFont-Text' name='MessageFont-Text' onchange='TextChange(this)' value='#ffffff' style = "text-align: center;" size="8"><br>
                    </div>
                    <div class="col">
                        <label id= 'MessageBorder-Label' for='MessageBorder-Colour'>Border Colour</label><br>
                        <a style="text-decoration: none;" href="https://www.patreon.com/bePatron?u=49614365" target="_blank" rel="noopener noreferrer">
                            <p style="color: #FF424D;margin:0;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                        </a>
                        <input type='color' id='MessageBorder-Colour' name='MessageBorder-Colour' onchange='ColourChange(this)' value='#491b00'><br>
                        <input type='text' id='MessageBorder-Text' name='MessageBorder-Text' onchange='TextChange(this)' value='#491b00' style = "text-align: center;" size="8"><br>
                    </div>
                    <div class="col">
                        <label id= 'MessageBackground1-Label' for='MessageBackground1-Colour'>Background Colour 1</label><br>
                        <a style="text-decoration: none;" href="https://www.patreon.com/bePatron?u=49614365" target="_blank" rel="noopener noreferrer">
                            <p style="color: #FF424D;margin:0;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                        </a>
                        <input type='color' id='MessageBackground1-Colour' name='MessageBackground1-Colour' onchange='ColourChange(this)' value='#b57340'><br>
                        <input type='text' id='MessageBackground1-Text' name='MessageBackground1-Text' onchange='TextChange(this)' value='#b57340' style = "text-align: center;" size="8"><br>
                    </div>
                    <div class="col">
                        <label id= 'MessageBackground2-Label' for='MessageBackground2-Colour'>Background Colour 2</label><br>
                        <a style="text-decoration: none;" href="https://www.patreon.com/bePatron?u=49614365" target="_blank" rel="noopener noreferrer">
                            <p style="color: #FF424D;margin:0;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                        </a>
                        <input type='color' id='MessageBackground2-Colour' name='MessageBackground2-Colour' onchange='ColourChange(this)' value='#7b4319'><br>
                        <input type='text' id='MessageBackground2-Text' name='MessageBackground2-Text' onchange='TextChange(this)' value='#7b4319' style = "text-align: center;" size="8"><br>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="NPCOverlay" style="display: block; z-index: -1">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Caesar+Dressing&family=Sigmar+One&family=Ubuntu&display=swap" rel="stylesheet">
        <div id="NPCOverlayMain">

        </div>
    </div>

</body>


<script>
    function Copyoutput() {
      /* Get the text field */
      var copyText = document.getElementById("output");

      /* Select the text field */
      copyText.select();
      copyText.setSelectionRange(0, 99999); /* For mobile devices */

      /* Copy the text inside the text field */
      document.execCommand("copy");
    }


  function ColourChange(selectObject) {
    let value = selectObject.value;
    let dashloc = selectObject.id.search("-")
    let textid = selectObject.id.substring(0, dashloc)+"-Text"
    let textel = document.getElementById(textid);
    textel.value = value;
    generateOverlay('This is a Test Message')
  }

  function TextChange(selectObject) {
    let value = selectObject.value;
    let dashloc = selectObject.id.search("-")
    let colourid = selectObject.id.substring(0, dashloc)+"-Colour"
    let colourel = document.getElementById(colourid);
    colourel.value = value;
    generateOverlay('This is a Test Message')
  }

  async function loadImage(imageUrl) {
    let img;
    const imageLoadPromise = new Promise(resolve => {
        img = new Image();
        img.onload = resolve;
        img.src = imageUrl;
    });

    await imageLoadPromise;
    console.log("image loaded");
    return {"w":img.width, "h":img.height};
}

async function generateOverlay() {
    document.getElementById('NPCOverlay').style.display = 'none'

    let imageUrl = document.getElementById('ImageLoc').value
    let message = document.getElementById('Message').value
    let name = document.getElementById('NamePlate').value

    let textwidth = $(window).width()-305-400-50

    let characterimgDIV = ''+
        '        <div id="charimgDIV">\n' +
        '            <img id="charimg" class="NPCOcharacterimg NPCOslide-in-fwd-left" src="'+imageUrl+'">\n' +
        '        </div>\n'

    let TextboxDIV = ''+
        '        <div  id="textbox"  class="NPCOtextbox NPCOslide-in-fwd-left" style="border-color: '+document.getElementById('MessageBorder-Text').value+';background-image: linear-gradient(120deg, '+document.getElementById('MessageBackground1-Text').value+','+document.getElementById('MessageBackground2-Text').value+');width:'+textwidth+'px; display: flex;justify-content: center;align-items: center;">\n' +
        '            <p class = "text-focus-in" style="color: '+document.getElementById('MessageFont-Text').value+';font-family: \'Ubuntu\', sans-serif;">'+message+'</p>\n' +
        '        </div>'

    let NameboxDIV = ''+
        '        <div  id="namebox" style="border-color: '+document.getElementById('NameBorder-Text').value+'; background-image: linear-gradient(120deg, '+document.getElementById('NameBackground1-Text').value+','+document.getElementById('NameBackground2-Text').value+');" class="NPCOnamebox NPCOslide-in-fwd-left">\n' +
        '            <p class = "text-focus-in" style="color: '+document.getElementById('NameFont-Text').value+'; font-family: \'Sigmar One\', cursive;margin:auto;white-space: nowrap;margin-left: 15px;margin-right: 15px;">'+name+'</p>\n' +
        '        </div>\n'

    let pack = characterimgDIV+TextboxDIV+NameboxDIV;

    document.getElementById("NPCOverlayMain").innerHTML = pack;

    let imgs = await loadImage(imageUrl);
    let ratio = imgs.w/imgs.h;
    let requiredheight = $(window).height()*0.70;
    let finalwidth = requiredheight*ratio
    let leftpos = 250-finalwidth/2
    console.log(leftpos);

    document.getElementById("charimg").style.left = leftpos+"px";


    document.getElementById('NPCOverlay').style.display = 'block';

    let formdata = {imageloc:imageUrl,
    name:name}


    var OutputText = document.getElementById("output");
    OutputText.value = JSON.stringify(formdata)

}

</script>


</html>