<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <title>SDoehren's NPC Overlay</title>
    <link rel="icon" href="img/logo.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <style>
        h1 {text-align: center;}
        p {text-align: center;}
        div {text-align: center;}

        input[type="number"] {font-size:30px; font-weight: bold;}

        body {
    background-color: #454545;
    color: #E8E8E8;
    font-family: 'Lato';
}
        .container-fluid {padding: 5px 25px 25px 25px;}

        .row-bottom-margin { margin:0px; }

        .NPCOcharacterimg{position:fixed;
        bottom:0;
        left:25px;
        height: calc(80%);
        border: none;
    }

    .NPCOnamebox {

        background-color: #a06538;
        border-radius: 3px;
        color: #fff;
        display:flex;

        position: fixed;
        bottom: 300px;
        left: 425px;

        height: 100px;

        text-align: center;
        font-size: 45px;



        border: 10px solid #491b00;
        box-sizing: content-box;

        box-shadow: 10px 5px 5px rgba(0, 0, 0, 0.31);


    }


    .NPCOtextbox {

        background-color: #a06538;
        border-radius: 3px;
        color: #fff;
        position: fixed;
        bottom: 60px;
        left: 400px;
        width: calc(100% - 900px);
        height: 250px;

        margin-top:30px;

        text-align: center;
        font-size: 30px;


        border: 10px solid #491b00;
        box-sizing: content-box;

        box-shadow: 10px 5px 5px rgba(0, 0, 0, 0.31);
    }


    .NPCOslide-in-fwd-left {
	-webkit-animation: NPCOslide-in-fwd-left 1s cubic-bezier(0.215, 0.610, 0.355, 1.000) ;
	        animation: NPCOslide-in-fwd-left 1s cubic-bezier(0.215, 0.610, 0.355, 1.000) ;
    }

    /* ----------------------------------------------
     * Generated by Animista on 2021-7-26 18:41:19
     * Licensed under FreeBSD License.
     * See http://animista.net/license for more info.
     * w: http://animista.net, t: @cssanimista
     * ---------------------------------------------- */

    @-webkit-keyframes NPCOslide-in-fwd-left {
      0% {
        -webkit-transform: translateX(-1000px)  rotate(-5deg);
                transform: translateX(-1000px)  rotate(-5deg);
        opacity: 0;
      }
      100% {
        -webkit-transform: translateX(0) rotate(-1deg);
                transform: translateX(0) rotate(-1deg);
        opacity: 1;
      }
    }
    @keyframes NPCOslide-in-fwd-left {
      0% {
        -webkit-transform: translateX(-1000px)  rotate(-5deg);
                transform: translateX(-1000px)  rotate(-5deg);
        opacity: 0;
      }
      100% {
        -webkit-transform: translateX(0) rotate(-1deg);
                transform: translateX(0) rotate(-1deg);
        opacity: 1;
      }
    }

    .NPCOslide-in-fwd-leftnoro {
	-webkit-animation: NPCOslide-in-fwd-leftnoro 1s cubic-bezier(0.215, 0.610, 0.355, 1.000) ;
	        animation: NPCOslide-in-fwd-leftnoro 1s cubic-bezier(0.215, 0.610, 0.355, 1.000) ;
    }

    /* ----------------------------------------------
     * Generated by Animista on 2021-7-26 18:41:19
     * Licensed under FreeBSD License.
     * See http://animista.net/license for more info.
     * w: http://animista.net, t: @cssanimista
     * ---------------------------------------------- */

    @-webkit-keyframes NPCOslide-in-fwd-leftnoro {
      0% {
        -webkit-transform: translateX(-1000px);
                transform: translateX(-1000px);
        opacity: 0;
      }
      100% {
        -webkit-transform: translateX(0);
                transform: translateX(0);
        opacity: 1;
      }
    }
    @keyframes NPCOslide-in-fwd-leftnoro {
      0% {
        -webkit-transform: translateX(-1000px);
                transform: translateX(-1000px);
        opacity: 0;
      }
      100% {
        -webkit-transform: translateX(0);
                transform: translateX(0);
        opacity: 1;
      }
    }


    </style>
</head>



<body onload="generateOverlay()">
    <div class="navbar navbar-expand-lg navbar-dark bg-dark" href="/">
        <div class="d-flex flex-grow-1">
            <a class="navbar-brand mx-auto" href="https://ko-fi.com/sdoehren" target="_blank" rel="noopener noreferrer">
            <img src="https://img.shields.io/badge/ko--fi-Support%20Me-red?style=flat-square&amp;logo=ko-fi" alt="ko-fi"></a>
            <a class="navbar-brand mx-auto" href="/">SDoehren<img src="img/logo.webp" alt="Logo" height="30"></a>
            <a class="navbar-brand mx-auto" href="https://www.patreon.com/sdoehren?utm_source=Mainsite&utm_medium=Referral&utm_campaign=NPCOverlay_Header" target="_blank" rel="noopener noreferrer">
            <img src="https://img.shields.io/badge/Patreon-Support%20Me-red?style=flat-square&amp;logo=patreon" alt="Patreon"></a>
        </div>
    </div>

    <div class="container-fluid" style="z-index: 5;position:relative">
        <div class="row row-bottom-margin">
            <h1>NPC Overlay</h1>
            <div class="col-5"></div>
            <div class="col-2">
                <a href="https://github.com/SDoehren/NPCOverlay" target="_blank" rel="noopener noreferrer">
                <img src="https://img.shields.io/badge/Github-Get%20Module-green?style=flat-square&amp;logo=github" alt="Patreon"></a>
            </div>
            <div class="span3">
                <button class="btn btn-primary" onclick="Hideform()" value="false" id="hidebutton">Hide Form</button>
                <button class="btn btn-primary" onclick="generateOverlay()">Repeat Animation</button>
            </div>
        </div>
        <div id="FormDiv" style="background-color: rgba(80, 80, 80, 0.5);border-radius: 40px;">
            <div class="row row-bottom-margin">
                <div class="col-4">
                    <h3>General</h3>
                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'ImageLoc-Label' for='ImageLoc'>Image Location (Use web accessible location and change in Foundry)</label>
                        </div>
                        <div class="col-6">
                            <input type='text' id='ImageLoc' name='ImageLoc' onchange='generateOverlay()' value='img/Hero-portrait.png' style = "width:90%;text-align: left;">
                        </div>
                    </div>
                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'OverlayName-Label' for='OverlayName'>Overlay Name</label>
                        </div>
                        <div class="col-6">
                            <input type='text' id='OverlayName' name='OverlayName' onchange='generateOverlay()' value='Overlay1' style = "width:90%;text-align: left;">
                        </div>
                    </div>
                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'Name-Label' for='NamePlate'>Name</label>
                        </div>
                        <div class="col-6">
                            <input type='text' id='NamePlate' name='NamePlate' onchange='generateOverlay()' value='Elfy McBbeg' style = "width:90%;text-align: left;">
                        </div>
                    </div>
                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'Message-Label' for='Message'>Dummy Message</label>
                        </div>
                        <div class="col-6">
                            <input type='text' id='Message' name='Message' onchange='generateOverlay()' value='Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec cursus vulputate leo, sed commodo sapien pharetra sed. Aliquam eget mauris in leo varius facilisis quis eu sapien. Vivamus id nibh sit amet magna iaculis elementum eget et nibh. Ut cursus, ante ut egestas efficitur, turpis nisi faucibus nisi, vel facilisis nulla erat eu turpis.' style = "width:90%;text-align: left;">
                        </div>
                    </div>
                </div>

                <div class="col-4">
                    <h3>Name Plaque</h3>
                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'NameFont-Label' for='NameFont-Colour' style="vertical-align:middle; display:inline;">Font Colour</label>
                            <a style="text-decoration: none;" href="https://www.patreon.com/sdoehren?utm_source=Mainsite&utm_medium=Referral&utm_campaign=NPCOverlay" target="_blank" rel="noopener noreferrer">
                                <p style="color: #FF424D;margin:0;display:inline;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                            </a>
                        </div>
                        <div class="col-6" >
                            <input type='color' id='NameFont-Colour' name='NameFont-Colour' onchange='ColourChange(this)' value='#ffffff' style="vertical-align:middle;">
                            <input type='text' id='NameFont-Text' name='NameFont-Text' onchange='TextChange(this)' value='#ffffff' style = "vertical-align:middle;text-align: center;" size="8">
                        </div>
                    </div>
                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'NameBorder-Label' for='NameBorder-Colour' style="vertical-align:middle; display:inline;">Border Colour</label>
                            <a style="text-decoration: none;" href="https://www.patreon.com/sdoehren?utm_source=Mainsite&utm_medium=Referral&utm_campaign=NPCOverlay" target="_blank" rel="noopener noreferrer">
                                <p style="color: #FF424D;margin:0;display:inline;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                            </a>
                        </div>
                        <div class="col-6" >
                            <input type='color' id='NameBorder-Colour' name='NameBorder-Colour' onchange='ColourChange(this)' value='#491b00' style="vertical-align:middle;">
                            <input type='text' id='NameBorder-Text' name='NameBorder-Text' onchange='TextChange(this)' value='#491b00' style = "vertical-align:middle;text-align: center;" size="8">
                        </div>
                    </div>

                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'NameBackground1-Label' for='NameBackground1-Colour' style="vertical-align:middle; display:inline;">Background Colour 1</label>
                            <a style="text-decoration: none;" href="https://www.patreon.com/sdoehren?utm_source=Mainsite&utm_medium=Referral&utm_campaign=NPCOverlay" target="_blank" rel="noopener noreferrer">
                                <p style="color: #FF424D;margin:0;display:inline;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                            </a>
                        </div>
                        <div class="col-6" >
                            <input type='color' id='NameBackground1-Colour' name='NameBackground1-Colour' onchange='ColourChange(this)' value='#b57340' style="vertical-align:middle;">
                            <input type='text' id='NameBackground1-Text' name='NameBackground1-Text' onchange='TextChange(this)' value='#b57340' style = "vertical-align:middle;text-align: center;" size="8">
                        </div>
                    </div>

                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'NameBackground2-Label' for='NameBackground2-Colour' style="vertical-align:middle; display:inline;">Background Colour 2</label>
                            <a style="text-decoration: none;" href="https://www.patreon.com/sdoehren?utm_source=Mainsite&utm_medium=Referral&utm_campaign=NPCOverlay" target="_blank" rel="noopener noreferrer">
                                <p style="color: #FF424D;margin:0;display:inline;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                            </a>
                        </div>
                        <div class="col-6" >
                            <input type='color' id='NameBackground2-Colour' name='NameBackground2-Colour' onchange='ColourChange(this)' value='#7b4319' style="vertical-align:middle;">
                            <input type='text' id='NameBackground2-Text' name='NameBackground1-Text' onchange='TextChange(this)' value='#7b4319' style = "vertical-align:middle;text-align: center;" size="8">
                        </div>
                    </div>
                </div>

                <div class="col-4">
                    <h3>Message Plaque</h3>
                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'MessageFont-Label' for='MessageFont-Colour' style="vertical-align:middle; display:inline;">Font Colour</label>
                            <a style="text-decoration: none;" href="https://www.patreon.com/sdoehren?utm_source=Mainsite&utm_medium=Referral&utm_campaign=NPCOverlay" target="_blank" rel="noopener noreferrer">
                                <p style="color: #FF424D;margin:0;display:inline;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                            </a>
                        </div>
                        <div class="col-6" >
                            <input type='color' id='MessageFont-Colour' name='MessageFont-Colour' onchange='ColourChange(this)' value='#ffffff' style="vertical-align:middle;">
                            <input type='text' id='MessageFont-Text' name='MessageFont-Text' onchange='TextChange(this)' value='#ffffff' style = "vertical-align:middle;text-align: center;" size="8">
                        </div>
                    </div>
                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'MessageBorder-Label' for='MessageBorder-Colour' style="vertical-align:middle; display:inline;">Border Colour</label>
                            <a style="text-decoration: none;" href="https://www.patreon.com/sdoehren?utm_source=Mainsite&utm_medium=Referral&utm_campaign=NPCOverlay" target="_blank" rel="noopener noreferrer">
                                <p style="color: #FF424D;margin:0;display:inline;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                            </a>
                        </div>
                        <div class="col-6" >
                            <input type='color' id='MessageBorder-Colour' name='MessageBorder-Colour' onchange='ColourChange(this)' value='#491b00' style="vertical-align:middle;">
                            <input type='text' id='MessageBorder-Text' name='MessageBorder-Text' onchange='TextChange(this)' value='#491b00' style = "vertical-align:middle;text-align: center;" size="8">
                        </div>
                    </div>

                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'MessageBackground1-Label' for='MessageBackground1-Colour' style="vertical-align:middle; display:inline;">Background Colour 1</label>
                            <a style="text-decoration: none;" href="https://www.patreon.com/sdoehren?utm_source=Mainsite&utm_medium=Referral&utm_campaign=NPCOverlay" target="_blank" rel="noopener noreferrer">
                                <p style="color: #FF424D;margin:0;display:inline;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                            </a>
                        </div>
                        <div class="col-6" >
                            <input type='color' id='MessageBackground1-Colour' name='MessageBackground1-Colour' onchange='ColourChange(this)' value='#b57340' style="vertical-align:middle;">
                            <input type='text' id='MessageBackground1-Text' name='MessageBackground1-Text' onchange='TextChange(this)' value='#b57340' style = "vertical-align:middle;text-align: center;" size="8">
                        </div>
                    </div>

                    <div class="row row-bottom-margin">
                        <div class="col-6">
                            <label id= 'MessageBackground2-Label' for='MessageBackground2-Colour' style="vertical-align:middle; display:inline;">Background Colour 2</label>
                            <a style="text-decoration: none;" href="https://www.patreon.com/sdoehren?utm_source=Mainsite&utm_medium=Referral&utm_campaign=NPCOverlay" target="_blank" rel="noopener noreferrer">
                                <p style="color: #FF424D;margin:0;display:inline;"><img class="card-img-top" src="img/Digital-Patreon-Logo_FieryCoral.png" alt="Patreon" style="height:20px;width:auto;"> only</p>
                            </a>
                        </div>
                        <div class="col-6" >
                            <input type='color' id='MessageBackground2-Colour' name='MessageBackground2-Colour' onchange='ColourChange(this)' value='#7b4319' style="vertical-align:middle;">
                            <input type='text' id='MessageBackground2-Text' name='MessageBackground1-Text' onchange='TextChange(this)' value='#7b4319' style = "vertical-align:middle;text-align: center;" size="8">
                        </div>
                    </div>
                </div>

            </div>


            <div class="row row-bottom-margin">
                <div class="row row-bottom-margin">
                    <h3 style="margin:0;">Output</h3>
                    <div class="col">
                        <input type='text' id='output' name='output' value='None' style = "width:90%;text-align: left;"><br>
                        <button class="btn btn-secondary" onclick="Copyoutput()">Copy Output</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="NPCOverlay" style="display: block; z-index: -1">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Caesar+Dressing&family=Sigmar+One&family=Ubuntu&display=swap" rel="stylesheet">
        <div id="NPCOverlayMain">

        </div>
    </div>

</body>


<script>
    function Hideform(){
        var hidebutton = document.getElementById("hidebutton");

        if (hidebutton.value === "false"){
            hidebutton.value = "true";
            hidebutton.innerHTML = "Show Form";
            document.getElementById("FormDiv").style.display = "none";
        } else {
            hidebutton.value = "false";
            hidebutton.innerHTML = "Hide Form";
            document.getElementById("FormDiv").style.display = "block";
        }
    }

    function Copyoutput() {
      /* Get the text field */
      var copyText = document.getElementById("output");

      /* Select the text field */
      copyText.select();
      copyText.setSelectionRange(0, 99999); /* For mobile devices */

      /* Copy the text inside the text field */
      document.execCommand("copy");
    }


  function ColourChange(selectObject) {
    let value = selectObject.value;
    let dashloc = selectObject.id.search("-")
    let textid = selectObject.id.substring(0, dashloc)+"-Text"
    let textel = document.getElementById(textid);
    textel.value = value;
    generateOverlay('This is a Test Message')
  }

  function TextChange(selectObject) {
    let value = selectObject.value;
    let dashloc = selectObject.id.search("-")
    let colourid = selectObject.id.substring(0, dashloc)+"-Colour"
    let colourel = document.getElementById(colourid);
    colourel.value = value;
    generateOverlay('This is a Test Message')
  }

  async function loadImage(imageUrl) {
    let img;
    const imageLoadPromise = new Promise(resolve => {
        img = new Image();
        img.onload = resolve;
        img.src = imageUrl;
    });

    await imageLoadPromise;
    console.log("image loaded");
    return {"w":img.width, "h":img.height};
}

async function generateOverlay() {
    document.getElementById('NPCOverlay').style.display = 'none'


    let imageUrl = document.getElementById('ImageLoc').value
    let message = document.getElementById('Message').value
    let name = document.getElementById('NamePlate').value

    let textwidth = $(window).width()-305-400-50

    let characterimgDIV = ''+
        '        <div id="charimgDIV">\n' +
        '            <img id="charimg" class="NPCOcharacterimg NPCOslide-in-fwd-leftnoro" src="'+imageUrl+'">\n' +
        '        </div>\n'

    let TextboxDIV = ''+
        '        <div  id="textbox"  class="NPCOtextbox NPCOslide-in-fwd-left" style="transform: rotate(-1deg); border-color: '+document.getElementById('MessageBorder-Text').value+';background-image: linear-gradient(120deg, '+document.getElementById('MessageBackground1-Text').value+','+document.getElementById('MessageBackground2-Text').value+');width:'+textwidth+'px; display: flex;justify-content: center;align-items: center;">\n' +
        '            <p class = "text-focus-in" style="transform: rotate(1deg);color: '+document.getElementById('MessageFont-Text').value+';font-family: \'Ubuntu\', sans-serif;">'+message+'</p>\n' +
        '        </div>'

    let NameboxDIV = ''+
        '        <div  id="namebox" style="transform: rotate(-1deg); border-color: '+document.getElementById('NameBorder-Text').value+'; background-image: linear-gradient(120deg, '+document.getElementById('NameBackground1-Text').value+','+document.getElementById('NameBackground2-Text').value+');" class="NPCOnamebox NPCOslide-in-fwd-left">\n' +
        '            <p class = "text-focus-in" style="transform: rotate(1deg);color: '+document.getElementById('NameFont-Text').value+'; font-family: \'Sigmar One\', cursive;margin:auto;white-space: nowrap;margin-left: 15px;margin-right: 15px;">'+name+'</p>\n' +
        '        </div>\n'

    let pack = characterimgDIV+TextboxDIV+NameboxDIV;

    document.getElementById("NPCOverlayMain").innerHTML = pack;

    let imgs = await loadImage(imageUrl);
    let ratio = imgs.w/imgs.h;
    let requiredheight = $(window).height()*0.70;
    let finalwidth = requiredheight*ratio
    let leftpos = 250-finalwidth/2
    console.log(leftpos);

    document.getElementById("charimg").style.left = leftpos+"px";


    document.getElementById('NPCOverlay').style.display = 'block';

    let formdata = {imageloc:imageUrl,
    name:name,
    namebox:{
        textcolour:document.getElementById('NameFont-Text').value,
        bordercolour:document.getElementById('NameBorder-Text').value,
        bg1:document.getElementById('NameBackground1-Text').value,
        bg2:document.getElementById('NameBackground2-Text').value
    },
    messagebox:{
        textcolour:document.getElementById('MessageFont-Text').value,
        bordercolour:document.getElementById('MessageBorder-Text').value,
        bg1:document.getElementById('MessageBackground1-Text').value,
        bg2:document.getElementById('MessageBackground2-Text').value
    }}

    var OutputText = document.getElementById("output");
    OutputText.value = document.getElementById('OverlayName').value+":"+JSON.stringify(formdata)

}

</script>


</html>